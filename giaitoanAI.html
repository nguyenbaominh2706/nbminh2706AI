<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>nbminh2706AI chat (Beautiful + LaTeX)</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      /* Changed to full width */
      width: 100%;
      max-width: 100%;
      margin: 0;
      padding: 24px;
      /* Modern AI-inspired blue and white background with mathematical elements */
      background: 
        radial-gradient(circle at 10% 20%, rgba(26, 41, 128, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(38, 208, 206, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.2) 0%, transparent 30%),
        linear-gradient(135deg, #e6f0ff 0%, #f0f8ff 50%, #e6f0ff 100%);
      color: #1a2980;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
      box-sizing: border-box;
    }
    
    /* Mathematical shapes as decorative elements */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        /* Mathematical symbols and shapes */
        radial-gradient(circle, #1a2980 1px, transparent 1px),
        radial-gradient(circle, #26d0ce 1px, transparent 1px),
        linear-gradient(90deg, transparent 79px, rgba(38, 208, 206, 0.1) 79px, rgba(38, 208, 206, 0.1) 81px, transparent 81px),
        linear-gradient(0deg, transparent 79px, rgba(26, 41, 128, 0.1) 79px, rgba(26, 41, 128, 0.1) 81px, transparent 81px);
      background-size: 
        40px 40px,
        60px 60px,
        80px 80px,
        80px 80px;
      background-position: 
        10% 10%,
        90% 90%,
        0 0,
        0 0;
      z-index: -1;
      opacity: 0.3;
    }
    
    h2 {
      text-align: center;
      color: #1a2980;
      margin-bottom: 24px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
      background: rgba(255, 255, 255, 0.7);
      padding: 15px;
      border-radius: 10px;
      backdrop-filter: blur(5px);
      /* Adjusted for full width */
      max-width: 100%;
      box-sizing: border-box;
    }
    textarea {
      width: 100%;
      height: 100px;
      font-size: 15px;
      padding: 10px;
      box-sizing: border-box;
      border: 1px solid rgba(26, 41, 128, 0.3);
      border-radius: 6px;
      margin-bottom: 10px;
      resize: vertical;
      background: rgba(255, 255, 255, 0.8);
      color: #1a2980;
    }
    textarea::placeholder {
      color: rgba(26, 41, 128, 0.5);
    }
    button {
      background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
      transition: all 0.3s ease;
      box-shadow: 0 2px 5px rgba(26, 41, 128, 0.3);
    }
    button:hover {
      background: linear-gradient(135deg, #26d0ce 0%, #1a2980 100%);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(26, 41, 128, 0.4);
    }
    #response {
      margin-top: 16px;
      white-space: normal;
      background: rgba(255, 255, 255, 0.8);
      padding: 12px;
      border-radius: 6px;
      min-height: 80px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      line-height: 1.6;
      border: 1px solid rgba(26, 41, 128, 0.1);
      /* Adjusted for full width */
      max-width: 100%;
      box-sizing: border-box;
    }
    #status {
      margin-top: 8px;
      color: rgba(26, 41, 128, 0.7);
      font-size: 13px;
      text-align: right;
    }
    .math-inline {
      display: inline;
    }
    label {
      display: block;
      margin-bottom: 8px;
      color: #1a2980;
      font-weight: 500;
    }
    h3 {
      color: #1a2980;
      background: rgba(255, 255, 255, 0.7);
      padding: 10px;
      border-radius: 6px;
      backdrop-filter: blur(5px);
      /* Adjusted for full width */
      max-width: 100%;
      box-sizing: border-box;
    }
  </style>
</head>
<body>
  <h2>nbminh2706AI — Chatbot AI</h2>

  <label for="prompt">Nhập câu hỏi:</label>
  <textarea id="prompt" placeholder="Viết câu hỏi..."></textarea>
  <br />
  <button id="send">Gửi</button>
  <div id="status"></div>

  <h3>Trả lời:</h3>
  <div id="response"></div>

  <script>
    const API_KEY = 'AIzaSyCOMMDzm8_1oc3gxldO9Bk6I9pT6uY2e8c';
    const MODEL = 'gemini-2.0-flash-thinking-exp-01-21';
    const ENDPOINT = `https://generativelanguage.googleapis.com/v1beta/models/${encodeURIComponent(MODEL)}:generateContent`;

    const sendBtn = document.getElementById('send');
    const promptEl = document.getElementById('prompt');
    const respEl = document.getElementById('response');
    const statusEl = document.getElementById('status');

    // Hàm xử lý và hiển thị nội dung với MathJax
    function processMathContent(content) {
      // Thay thế các ký hiệu $...$ thành \(...\) để MathJax hiểu
      // Giữ nguyên các dấu xuống dòng
      let processedContent = content
        .replace(/\$\$(.*?)\$\$/g, '\\[$1\\]')  // Công thức toán hiển thị riêng dòng
        .replace(/\$(.*?)\$/g, '\\($1\\)');    // Công thức toán nội dòng
      
      // Thay thế xuống dòng thành thẻ <br>
      processedContent = processedContent.replace(/\n/g, '<br>');
      
      return processedContent;
    }

    sendBtn.addEventListener('click', async () => {
      const text = (promptEl.value || '').trim();
      if (!text) {
        respEl.innerHTML = 'Vui lòng nhập câu hỏi trước.';
        return;
      }

      statusEl.textContent = 'Đang gửi...';
      respEl.innerHTML = '';
      sendBtn.disabled = true;

      try {
        const payload = {
          contents: [{ parts: [{ text: text }] }]
        };

        const res = await fetch(ENDPOINT, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-goog-api-key': API_KEY
          },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const errText = await res.text();
          statusEl.textContent = `Lỗi HTTP ${res.status}`;
          respEl.innerHTML = `Chi tiết lỗi: ${errText}`;
          sendBtn.disabled = false;
          return;
        }

        const data = await res.json();

        let out = '';
        if (data.candidates?.length > 0) {
          out = data.candidates.map(c => {
            if (c.content?.parts) {
              return c.content.parts.map(p => p.text || '').join('\n');
            }
            return c.text || JSON.stringify(c);
          }).join('\n\n---\n\n');
        } else {
          out = JSON.stringify(data, null, 2);
        }

        // Xử lý nội dung để hiển thị công thức toán học
        respEl.innerHTML = processMathContent(out);

        // Đảm bảo MathJax đã được tải trước khi gọi typeset
        if (window.MathJax && window.MathJax.typesetPromise) {
          MathJax.typesetPromise([respEl]).catch(err => {
            console.error('MathJax typeset error:', err);
          });
        } else {
          // Nếu MathJax chưa tải, thử lại sau một khoảng thời gian
          const checkMathJax = setInterval(() => {
            if (window.MathJax && window.MathJax.typesetPromise) {
              clearInterval(checkMathJax);
              MathJax.typesetPromise([respEl]).catch(err => {
                console.error('MathJax typeset error:', err);
              });
            }
          }, 100);
        }

        statusEl.textContent = 'Hoàn thành';
      } catch (err) {
        statusEl.textContent = 'Lỗi gửi';
        respEl.innerHTML = String(err);
      } finally {
        sendBtn.disabled = false;
      }
    });

    promptEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
        sendBtn.click();
      }
    });
  </script>
</body>
</html>
